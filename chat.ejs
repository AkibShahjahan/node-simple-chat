<html>
    <head>
        <script src="http://<%= HOST %>:<%= PORT %>/socket.io/socket.io.js"></script>
        <script src="http://code.jquery.com/jquery-1.7.1.js" type="text/javascript"></script>
        <script type="text/javascript">

            var socket = io.connect('http://<%= HOST %>:<%= PORT %>');

            socket.on('msg', function(data) {
                var msg = JSON.parse(data);
                appendMsg(msg);
            });

            socket.on('init', function(data) {
                var messages = JSON.parse(data)
                for (i in messages)
                    appendMsg(messages[i])
            });

            function appendMsg(msg) {
                $('#msgs').append(function() {
                    var div = $('<div>');
                    div.html('<b>' + msg.username + ':</b> ' + msg.message);
                    return div;
                });
                $('#msgs')[0].scrollTop = $('#msgs')[0].scrollHeight;
            }

            function sendMsg() {
                var msg = {};
                $.each($('#chat').serializeArray(), function(i,v) {
                    msg[v.name] = v.value;
                });
                $("#msg").val("");
                appendMsg(msg);
                socket.emit('msg', JSON.stringify(msg));
            }
        </script>
        <style type="text/css">
            #msgs {
              height: 300px;
              background: #f3f3ff;
              font-family: monospace, sans; 
              overflow:auto;
            }

            .chat-title {
              color: white;
              background: #a2a2ee;
              font-weight: bold;
              font-size: 20px;
              height: 24px;
              padding: 2px;
            }
        </style>
    </head>
    <body>
        <div>
            <p class="chat-title" onclick="javascript: toggleChat();">Real Time Chat</p>
            <div id="msgs"></div>
            <div id="form">
                <form id="chat" onsubmit="sendMsg(); return false;">
                    <label for="username">Username: </label><input name="username" type="text"><br/>
                    <label for="msg"> Message: </label><input id="msg" type="text" name="message"/><br/>
                    <input type="submit"/>
                </form>
            </div>
        </div>
    </body>
</html>
